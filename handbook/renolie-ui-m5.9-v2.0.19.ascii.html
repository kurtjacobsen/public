<!-- renolie-ui-m5.9-v2.0.19.ascii.html -->
<!doctype html>
<html lang="da">
<head>
  <meta charset="utf-8">
  <title>RENOLIE UI m5.9 v2.0.19</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data:; img-src 'self' data: https:; style-src 'unsafe-inline' 'self'; script-src 'self' 'unsafe-inline'; connect-src 'self' https:;">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family: Arial, sans-serif; margin:16px; line-height:1.4}
    h1{font-size:18px;margin:0 0 8px}
    .row{margin:8px 0}
    input,textarea,button{font-size:14px}
    textarea{width:100%;height:140px}
    code,pre{background:#f4f4f4;padding:8px;display:block;white-space:pre-wrap;word-break:break-word}
    .muted{color:#666}
  </style>
</head>
<body>
  <h1>RENOLIE UI m5.9 v2.0.19</h1>
  <div class="row muted">Enc-check: &aelig; &oslash; &aring; &AElig; &Oslash; &Aring; &deg;</div>

  <div class="row">
    <label for="proxy">Proxy base (https):</label><br>
    <input id="proxy" type="text" style="width:100%" value="https://renolie-proxy.onrender.com">
  </div>

  <div class="row">
    <label for="md">Recipe markdown (valgfri):</label>
    <textarea id="md"># Test
- Dette er en test
- &aelig; &oslash; &aring;</textarea>
  </div>

  <div class="row">
    <button id="btnMake">Generate PDF</button>
    <button id="btnEcho">Echo demo=1</button>
  </div>

  <div class="row">
    <strong>Response:</strong>
    <pre id="out">(tom)</pre>
  </div>

  <script>
    function b64ToUint8Array(b64) {
      const bin = atob(b64);
      const len = bin.length;
      const bytes = new Uint8Array(len);
      for (let i=0;i<len;i++) bytes[i] = bin.charCodeAt(i);
      return bytes;
    }

    async function openPdfFromUrlMaybeData(pdfUrl) {
      try {
        if (typeof pdfUrl !== 'string' || pdfUrl.length < 10) {
          alert('Tom eller ugyldig pdfUrl');
          return;
        }
        if (pdfUrl.startsWith('data:application/pdf;base64,')) {
          const b64 = pdfUrl.split('base64,')[1] || '';
          const bytes = b64ToUint8Array(b64);
          const blob = new Blob([bytes], { type: 'application/pdf' });
          const url = URL.createObjectURL(blob);
          window.open(url, '_blank', 'noopener');
        } else {
          window.open(pdfUrl, '_blank', 'noopener');
        }
      } catch (e) {
        console.error(e);
        alert('Kunne ikke &aring;bne PDF: ' + (e && e.message ? e.message : String(e)));
      }
    }

    function show(obj) {
      const out = document.getElementById('out');
      try { out.textContent = JSON.stringify(obj, null, 2); }
      catch { out.textContent = String(obj); }
    }

    document.getElementById('btnEcho').addEventListener('click', async () => {
      const base = document.getElementById('proxy').value.trim();
      const url = base.replace(/\/+$/,'') + '/pdf/echo?demo=1';
      const r = await fetch(url);
      const j = await r.json();
      show(j);
    });

    document.getElementById('btnMake').addEventListener('click', async () => {
      const base = document.getElementById('proxy').value.trim();
      const url = base.replace(/\/+$/,'') + '/pdf/make';
      const md = document.getElementById('md').value;
      const body = md.trim().length ? { recipe_markdown: md } : {};
      const r = await fetch(url, {
        method:'POST',
        headers:{ 'Content-Type':'application/json' },
        body: JSON.stringify(body)
      });
      const j = await r.json();
      show(j);
      if (j && j.ok && j.pdfUrl) {
        await openPdfFromUrlMaybeData(j.pdfUrl);
      }
    });
  </script>
</body>
</html>
